{"version":3,"sources":["../../../units/urb-base-tools/build-units.js"],"names":["existsAsync","exists","readFileAsync","readFile","readdirAsync","readdir","sortObject","object","t","Object","keys","sort","forEach","k","orderPackages","packageAsObject","scripts","dependencies","devDependencies","mergeScripts","scripts1","scripts2","scriptName","script","script2","createPackageJson","units","packageJsonFileName","resolve","currentPackageAsJSONString","toString","currentPackageAsObject","JSON","parse","engines","name","prettier","version","unitName","packageAsObjectName","packageToAddAsObject","stringify","createMutations","mutationsImports","mutationsExports","endsWith","mutationsDir","mutationFileNames","mutationFileName","mutation","substring","length","push","replace","mutations","concat","format","join","createSchemas","schemasImports","schemasDir","objectTypeFileNames","objectTypeFileName","objectType","schemas","createViewerFields","viewerFieldsImports","viewerFieldsExports","viewerFieldsFileName","viewerFieldsImportName","viewerFields","createRoutes","routesAppFrameImports","routesRootImports","routesAppFrameExports","routesRootExports","routesDir","routeFileNames","routeFileName","startsWith","route","Promise","all","createRouteFile","fileName","imports","exports","routesAppFrame","getUnits","filter","main","taskPromises","then","console","log"],"mappings":"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","file":"build-units.js","sourcesContent":["// @flow\n\nimport fs from 'fs'\nimport path from 'path'\nimport { promisify } from 'util'\n\nimport prettier from 'prettier'\n\n// $FlowIssue Not sure why it gives an error. The file does exist\nimport packageJSON from '../../package.json'\n\nimport ensureFileContent from './ensureFileContent'\n\nconst existsAsync = promisify( fs.exists )\nconst readFileAsync = promisify( fs.readFile )\nconst readdirAsync = promisify( fs.readdir )\n\nfunction sortObject( object: Object ) {\n  var t = {}\n  Object.keys( object )\n    .sort()\n    .forEach( function( k ) {\n      t[k] = object[k]\n    })\n  return t\n}\n\nfunction orderPackages( packageAsObject ) {\n  packageAsObject.scripts = sortObject( packageAsObject.scripts )\n  packageAsObject.dependencies = sortObject( packageAsObject.dependencies )\n  packageAsObject.devDependencies = sortObject( packageAsObject.devDependencies )\n}\n\nfunction mergeScripts( scripts1, scripts2 ) {\n  const scripts = Object.assign({}, scripts1 )\n\n  for ( let scriptName in scripts2 ) {\n    const script = scripts[scriptName]\n    const script2 = scripts2[scriptName]\n\n    if ( script && script2 ) {\n      scripts[scriptName] = script + ' && ' + script2\n    } else if ( script2 ) {\n      scripts[scriptName] = script2\n    }\n  }\n\n  return scripts\n}\n\nasync function createPackageJson( units: Array<string> ) {\n  const packageJsonFileName = path.resolve( './package.json' )\n  const currentPackageAsJSONString = ( await readFileAsync( packageJsonFileName ) ).toString()\n  const currentPackageAsObject = JSON.parse( currentPackageAsJSONString )\n  const packageAsObject = {\n    dependencies: {},\n    devDependencies: {},\n    engines: {},\n    'lint-staged': {},\n    name: null,\n    prettier: {},\n    scripts: {},\n    version: null,\n  }\n\n  // Make sure not to overwrite version information\n  packageAsObject.version = currentPackageAsObject.version\n  packageAsObject.name = currentPackageAsObject.name\n\n  // Add packages to object\n  for ( let unitName of units ) {\n    const packageAsObjectName = path.resolve( './units', unitName, 'package.part.json' )\n    if ( await existsAsync( packageAsObjectName ) ) {\n      const packageToAddAsObject = JSON.parse( ( await readFileAsync( packageAsObjectName ) ).toString() )\n\n      if ( packageToAddAsObject.dependencies )\n        Object.assign( packageAsObject.dependencies, packageToAddAsObject.dependencies )\n      if ( packageToAddAsObject.devDependencies )\n        Object.assign( packageAsObject.devDependencies, packageToAddAsObject.devDependencies )\n      if ( packageToAddAsObject.engines )\n        Object.assign( packageAsObject.engines, packageToAddAsObject.engines )\n      if ( packageToAddAsObject['lint-staged'])\n        Object.assign( packageAsObject['lint-staged'], packageToAddAsObject['lint-staged'])\n      if ( packageToAddAsObject.prettier )\n        Object.assign( packageAsObject.prettier, packageToAddAsObject.prettier )\n      if ( packageToAddAsObject.scripts )\n        packageAsObject.scripts = mergeScripts(\n          packageAsObject.scripts,\n          packageToAddAsObject.scripts,\n        )\n    }\n  }\n\n  // Make them pretty\n  orderPackages( packageAsObject )\n\n  await ensureFileContent(\n    packageJsonFileName,\n    currentPackageAsJSONString,\n    JSON.stringify( packageAsObject, null, 2 ),\n  )\n}\n\nasync function createMutations( units: Array<string> ) {\n  const mutationsImports = []\n  const mutationsExports = []\n\n  for ( let unitName of units )\n    if ( unitName.endsWith( '-server' ) ) {\n      const mutationsDir = path.resolve( './units', unitName, 'graphql/mutation' )\n      if ( await existsAsync( mutationsDir ) ) {\n        const mutationFileNames = await readdirAsync( mutationsDir )\n\n        for ( let mutationFileName of mutationFileNames ) {\n          if ( mutationFileName.endsWith( '.js' ) ) {\n            const mutation = mutationFileName.substring( 0, mutationFileName.length - 3 )\n            mutationsImports.push(\n              'import ' +\n                mutation.replace( '.', '_' ) +\n                ' from \\'../../../' +\n                unitName +\n                '/graphql/mutation/' +\n                mutation +\n                '\\'',\n            )\n            mutationsExports.push( '  ' + mutation + ',' )\n          }\n        }\n      }\n    }\n\n  let mutations = [ '// @flow', '' ]\n  mutations = mutations.concat( mutationsImports )\n  mutations = mutations.concat([ '', 'export default {' ])\n  mutations = mutations.concat( mutationsExports )\n  mutations = mutations.concat([ '}' ])\n\n  await ensureFileContent(\n    path.resolve( './units/_configuration/urb-base-server/graphql/_mutations.js' ),\n    null,\n    prettier.format( mutations.join( '\\r\\n' ), packageJSON.prettier ),\n  )\n}\n\nasync function createSchemas( units: Array<string> ) {\n  const schemasImports = []\n\n  for ( let unitName of units )\n    if ( unitName.endsWith( '-server' ) ) {\n      const schemasDir = path.resolve( './units', unitName, 'graphql/model' )\n      if ( await existsAsync( schemasDir ) ) {\n        const objectTypeFileNames = await readdirAsync( schemasDir )\n\n        for ( let objectTypeFileName of objectTypeFileNames ) {\n          if ( objectTypeFileName.endsWith( '.js' ) ) {\n            const objectType = objectTypeFileName.substring( 0, objectTypeFileName.length - 3 )\n            schemasImports.push(\n              'import \\'../../../' + unitName + '/graphql/model/' + objectType + '\\'',\n            )\n          }\n        }\n      }\n    }\n\n  let schemas = [ '// @flow', '' ]\n  schemas = schemas.concat( schemasImports )\n  schemas = schemas.concat([ '', 'export default true' ])\n\n  await ensureFileContent(\n    path.resolve( './units/_configuration/urb-base-server/graphql/_schemas.js' ),\n    null,\n    prettier.format( schemas.join( '\\r\\n' ), packageJSON.prettier ),\n  )\n}\n\nasync function createViewerFields( units: Array<string> ) {\n  const viewerFieldsImports = []\n  const viewerFieldsExports = []\n\n  for ( let unitName of units )\n    if ( unitName.endsWith( '-server' ) ) {\n      const viewerFieldsFileName = path.resolve(\n        './units',\n        unitName,\n        'graphql/type/_ViewerFields.js',\n      )\n      if ( await existsAsync( viewerFieldsFileName ) ) {\n        const viewerFieldsImportName = unitName.replace( /-/g, '_' )\n        viewerFieldsImports.push(\n          'import ' +\n            viewerFieldsImportName +\n            ' from \\'../../../' +\n            unitName +\n            '/graphql/type/_ViewerFields\\'',\n        )\n        viewerFieldsExports.push( '  ...' + viewerFieldsImportName + ',' )\n      }\n    }\n\n  let viewerFields = [ '// @flow', '' ]\n  viewerFields = viewerFields.concat( viewerFieldsImports )\n  viewerFields = viewerFields.concat([ '', 'export default {' ])\n  viewerFields = viewerFields.concat( viewerFieldsExports )\n  viewerFields = viewerFields.concat([ '}' ])\n\n  await ensureFileContent(\n    path.resolve( './units/_configuration/urb-base-server/graphql/_ViewerFields.js' ),\n    null,\n    prettier.format( viewerFields.join( '\\r\\n' ), packageJSON.prettier ),\n  )\n}\n\nasync function createRoutes( units: Array<string> ) {\n  const routesAppFrameImports = []\n  const routesRootImports = []\n  const routesAppFrameExports = []\n  const routesRootExports = []\n\n  for ( let unitName of units )\n    if ( unitName.endsWith( '-webapp' ) ) {\n      const routesDir = path.resolve( './units', unitName )\n      if ( await existsAsync( routesDir ) ) {\n        const routeFileNames = await readdirAsync( routesDir )\n\n        for ( let routeFileName of routeFileNames ) {\n          if ( routeFileName.endsWith( '.jsx' ) )\n            if ( routeFileName.startsWith( 'routeAppFrame' ) ) {\n              const route = routeFileName.substring( 0, routeFileName.length - 4 )\n              routesAppFrameImports.push(\n                'import ' + route + ' from \\'../../' + unitName + '/' + route + '\\'',\n              )\n              routesAppFrameExports.push( '  ' + route + ',' )\n            } else if ( routeFileName.startsWith( 'routeRoot' ) ) {\n              const route = routeFileName.substring( 0, routeFileName.length - 4 )\n              routesRootImports.push(\n                'import ' + route + ' from \\'../../' + unitName + '/' + route + '\\'',\n              )\n              routesRootExports.push( '  ' + route + ',' )\n            }\n        }\n      }\n    }\n\n  await Promise.all([\n    createRouteFile(\n      path.resolve( './units/_configuration/urb-base-webapp/routesAppFrame.js' ),\n      routesAppFrameImports,\n      routesAppFrameExports,\n    ),\n    createRouteFile(\n      path.resolve( './units/_configuration/urb-base-webapp/routesRoot.js' ),\n      routesRootImports,\n      routesRootExports,\n    ),\n  ])\n}\n\nasync function createRouteFile( fileName: string, imports: Array<string>, exports: Array<string> ) {\n  let routesAppFrame = [ '// @flow', '' ]\n  routesAppFrame = routesAppFrame.concat( imports )\n  routesAppFrame = routesAppFrame.concat([ '', 'export default [' ])\n  routesAppFrame = routesAppFrame.concat( exports )\n  routesAppFrame = routesAppFrame.concat([ ']' ])\n\n  await ensureFileContent(\n    fileName,\n    null,\n    prettier.format( routesAppFrame.join( '\\r\\n' ), packageJSON.prettier ),\n  )\n}\n\nasync function getUnits() {\n  const units = ( await readdirAsync( './units/' ) ).filter(\n    fileName => fileName !== '.DS_Store' && fileName !== '_configuration',\n  )\n  return units\n}\n\nasync function main() {\n  const units = await getUnits()\n\n  const taskPromises = [\n    createPackageJson( units ),\n    createViewerFields( units ),\n    createSchemas( units ),\n    createMutations( units ),\n    createRoutes( units ),\n  ]\n\n  await Promise.all( taskPromises )\n}\n\nmain().then( () => console.log( 'Fin.' ) )\n"]}